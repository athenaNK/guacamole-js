!function(){var e=e||{};e.ArrayBufferReader=function(e){var t=this;e.onblob=function(e){for(var n=window.atob(e),r=new ArrayBuffer(n.length),o=new Uint8Array(r),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);t.ondata&&t.ondata(r)},e.onend=function(){t.onend&&t.onend()},this.ondata=null,this.onend=null};var e=e||{};e.ArrayBufferWriter=function(t){function n(e){for(var n="",r=0;r<e.byteLength;r++)n+=String.fromCharCode(e[r]);t.sendBlob(window.btoa(n))}var r=this;t.onack=function(e){r.onack&&r.onack(e)},this.blobLength=e.ArrayBufferWriter.DEFAULT_BLOB_LENGTH,this.sendData=function(e){var t=new Uint8Array(e);if(t.length<=r.blobLength)n(t);else for(var o=0;o<t.length;o+=r.blobLength)n(t.subarray(o,o+r.blobLength))},this.sendEnd=function(){t.sendEnd()},this.onack=null},e.ArrayBufferWriter.DEFAULT_BLOB_LENGTH=6048;var e=e||{};e.AudioContextFactory={singleton:null,getAudioContext:function(){var t=window.AudioContext||window.webkitAudioContext;if(t)try{return e.AudioContextFactory.singleton||(e.AudioContextFactory.singleton=new t),e.AudioContextFactory.singleton}catch(n){}return null}};var e=e||{};e.AudioPlayer=function(){this.sync=function(){}},e.AudioPlayer.isSupportedType=function(t){return e.RawAudioPlayer.isSupportedType(t)},e.AudioPlayer.getSupportedTypes=function(){return e.RawAudioPlayer.getSupportedTypes()},e.AudioPlayer.getInstance=function(t,n){return e.RawAudioPlayer.isSupportedType(n)?new e.RawAudioPlayer(t,n):null},e.RawAudioPlayer=function(t,n){var r=e.RawAudioFormat.parse(n),o=e.AudioContextFactory.getAudioContext(),i=o.currentTime,a=new e.ArrayBufferReader(t),s=.02,u=.3,l=1===r.bytesPerSample?window.Int8Array:window.Int16Array,c=1===r.bytesPerSample?128:32768,d=[],f=function(e){if(e.length<=1)return e[0];var t=0;e.forEach(function(e){t+=e.length});var n=0,r=new l(t);return e.forEach(function(e){r.set(e,n),n+=e.length}),r},h=function(e){for(var t=Number.MAX_VALUE,n=e.length,o=Math.floor(e.length/r.channels),i=Math.floor(r.rate*s),a=Math.max(r.channels*i,r.channels*(o-i)),u=a;u<e.length;u+=r.channels){for(var c=0,d=0;d<r.channels;d++)c+=Math.abs(e[u+d]);c<=t&&(n=u+r.channels,t=c)}return n===e.length?[e]:[new l(e.buffer.slice(0,n*r.bytesPerSample)),new l(e.buffer.slice(n*r.bytesPerSample))]},p=function(e){d.push(new l(e))},v=function(){var e=f(d);return e?(d=h(e),e=d.shift()):null},g=function(e){var t=e.length/r.channels,n=o.currentTime;i<n&&(i=n);for(var a=o.createBuffer(r.channels,t,r.rate),s=0;s<r.channels;s++)for(var u=a.getChannelData(s),l=s,d=0;d<t;d++)u[d]=e[l]/c,l+=r.channels;return a};a.ondata=function(e){p(new l(e));var t=v();if(t){var n=o.currentTime;i<n&&(i=n);var a=o.createBufferSource();a.connect(o.destination),a.start||(a.start=a.noteOn),a.buffer=g(t),a.start(i),i+=t.length/r.channels/r.rate}},this.sync=function(){var e=o.currentTime;i=Math.min(i,e+u)}},e.RawAudioPlayer.prototype=new e.AudioPlayer,e.RawAudioPlayer.isSupportedType=function(t){return!!e.AudioContextFactory.getAudioContext()&&null!==e.RawAudioFormat.parse(t)},e.RawAudioPlayer.getSupportedTypes=function(){return e.AudioContextFactory.getAudioContext()?["audio/L8","audio/L16"]:[]};var e=e||{};e.AudioRecorder=function(){this.onclose=null,this.onerror=null},e.AudioRecorder.isSupportedType=function(t){return e.RawAudioRecorder.isSupportedType(t)},e.AudioRecorder.getSupportedTypes=function(){return e.RawAudioRecorder.getSupportedTypes()},e.AudioRecorder.getInstance=function(t,n){return e.RawAudioRecorder.isSupportedType(n)?new e.RawAudioRecorder(t,n):null},e.RawAudioRecorder=function(t,n){var r=this,o=2048,i=3,a=e.RawAudioFormat.parse(n),s=e.AudioContextFactory.getAudioContext(),u=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(navigator),l=new e.ArrayBufferWriter(t),c=1===a.bytesPerSample?window.Int8Array:window.Int16Array,d=1===a.bytesPerSample?128:32768,f=0,h=0,p=null,v=null,g=null,m=function(e){if(0===e)return 1;var t=Math.PI*e;return Math.sin(t)/t},y=function(e,t){return-t<e&&e<t?m(e)*m(e/t):0},w=function(e,t){for(var n=(e.length-1)*t,r=Math.floor(n)-i+1,o=Math.floor(n)+i,a=0,s=r;s<=o;s++)a+=(e[s]||0)*y(n-s,i);return a},S=function(e){var t=e.length;f+=t;var n=Math.round(f*a.rate/e.sampleRate),r=n-h;h+=r;for(var o=new c(r*a.channels),i=0;i<a.channels;i++)for(var s=e.getChannelData(i),u=i,l=0;l<r;l++)o[u]=w(s,l/(r-1))*d,u+=a.channels;return o},b=function(){u({audio:!0},function(e){g=s.createScriptProcessor(o,a.channels,a.channels),g.connect(s.destination),g.onaudioprocess=function(e){l.sendData(S(e.inputBuffer).buffer)},v=s.createMediaStreamSource(e),v.connect(g),p=e},function(){l.sendEnd(),r.onerror&&r.onerror()})},I=function(){if(v&&v.disconnect(),g&&g.disconnect(),p)for(var e=p.getTracks(),t=0;t<e.length;t++)e[t].stop();g=null,v=null,p=null,l.sendEnd()};l.onack=function(t){t.code!==e.Status.Code.SUCCESS||p?(I(),l.onack=null,t.code===e.Status.Code.RESOURCE_CLOSED?r.onclose&&r.onclose():r.onerror&&r.onerror()):b()}},e.RawAudioRecorder.prototype=new e.AudioRecorder,e.RawAudioRecorder.isSupportedType=function(t){return!!e.AudioContextFactory.getAudioContext()&&null!==e.RawAudioFormat.parse(t)},e.RawAudioRecorder.getSupportedTypes=function(){return e.AudioContextFactory.getAudioContext()?["audio/L8","audio/L16"]:[]};var e=e||{};e.BlobReader=function(e,t){var n,r=this,o=0;n=window.BlobBuilder?new BlobBuilder:window.WebKitBlobBuilder?new WebKitBlobBuilder:window.MozBlobBuilder?new MozBlobBuilder:new function(){var e=[];this.append=function(n){e.push(new Blob([n],{type:t}))},this.getBlob=function(){return new Blob(e,{type:t})}},e.onblob=function(t){for(var i=window.atob(t),a=new ArrayBuffer(i.length),s=new Uint8Array(a),u=0;u<i.length;u++)s[u]=i.charCodeAt(u);n.append(a),o+=a.byteLength,r.onprogress&&r.onprogress(a.byteLength),e.sendAck("OK",0)},e.onend=function(){r.onend&&r.onend()},this.getLength=function(){return o},this.getBlob=function(){return n.getBlob()},this.onprogress=null,this.onend=null};var e=e||{};e.BlobWriter=function(t){var n=this,r=new e.ArrayBufferWriter(t);r.onack=function(e){n.onack&&n.onack(e)};var o=function(e,t,n){var r=(e.slice||e.webkitSlice||e.mozSlice).bind(e),o=n-t;if(o!==n){var i=r(t,o);if(i.size===o)return i}return r(t,n)};this.sendBlob=function(e){var t=0,i=new FileReader,a=function(){if(t>=e.size)return void(n.oncomplete&&n.oncomplete(e));var a=o(e,t,t+r.blobLength);t+=r.blobLength,i.readAsArrayBuffer(a)};i.onload=function(){r.sendData(i.result),r.onack=function(o){n.onack&&n.onack(o),o.isError()||(n.onprogress&&n.onprogress(e,t-r.blobLength),a())}},i.onerror=function(){n.onerror&&n.onerror(e,t,i.error)},a()},this.sendEnd=function(){r.sendEnd()},this.onack=null,this.onerror=null,this.onprogress=null,this.oncomplete=null};var e=e||{};e.Client=function(t){function n(e){e!=f&&(f=e,i.onstatechange&&i.onstatechange(f))}function r(){return f==l||f==u}function o(n){var r=b[n];return null==r&&(r=b[n]=new e.Parser,r.oninstruction=t.oninstruction),r}var i=this,a=0,s=1,u=2,l=3,c=4,d=5,f=a,h=0,p=null,v={0:"butt",1:"round",2:"square"},g={0:"bevel",1:"miter",2:"round"},m=new e.Display,y={},w={},S={},b=[],I=[],T=[],C=new e.IntegerPool,E=[];this.getDisplay=function(){return m},this.sendSize=function(e,n){r()&&t.sendMessage("size",e,n)},this.sendKeyEvent=function(e,n){r()&&t.sendMessage("key",n,e)},this.sendMouseState=function(e){if(r()){m.moveCursor(Math.floor(e.x),Math.floor(e.y));var n=0;e.left&&(n|=1),e.middle&&(n|=2),e.right&&(n|=4),e.up&&(n|=8),e.down&&(n|=16),t.sendMessage("mouse",Math.floor(e.x),Math.floor(e.y),n)}},this.setClipboard=function(t){if(r()){for(var n=i.createClipboardStream("text/plain"),o=new e.StringWriter(n),a=0;a<t.length;a+=4096)o.sendText(t.substring(a,a+4096));o.sendEnd()}},this.createOutputStream=function(){var t=C.next(),n=E[t]=new e.OutputStream(i,t);return n},this.createAudioStream=function(e){var n=i.createOutputStream();return t.sendMessage("audio",n.index,e),n},this.createFileStream=function(e,n){var r=i.createOutputStream();return t.sendMessage("file",r.index,e,n),r},this.createPipeStream=function(e,n){var r=i.createOutputStream();return t.sendMessage("pipe",r.index,e,n),r},this.createClipboardStream=function(e){var n=i.createOutputStream();return t.sendMessage("clipboard",n.index,e),n},this.createObjectOutputStream=function(e,n,r){var o=i.createOutputStream();return t.sendMessage("put",e,o.index,n,r),o},this.requestObjectInputStream=function(e,n){r()&&t.sendMessage("get",e,n)},this.sendAck=function(e,n,o){r()&&t.sendMessage("ack",e,n,o)},this.sendBlob=function(e,n){r()&&t.sendMessage("blob",e,n)},this.endStream=function(e){r()&&(t.sendMessage("end",e),E[e]&&(C.free(e),delete E[e]))},this.onstatechange=null,this.onname=null,this.onerror=null,this.onaudio=null,this.onvideo=null,this.onclipboard=null,this.onfile=null,this.onfilesystem=null,this.onpipe=null,this.onsync=null;var k=function(e){var t=y[e];return t||(t=0===e?m.getDefaultLayer():e>0?m.createLayer():m.createBuffer(),y[e]=t),t},A={"miter-limit":function(e,t){m.setMiterLimit(e,parseFloat(t))}},L={ack:function(t){var n=parseInt(t[0]),r=t[1],o=parseInt(t[2]),i=E[n];i&&(i.onack&&i.onack(new e.Status(o,r)),o>=256&&E[n]===i&&(C.free(n),delete E[n]))},arc:function(e){var t=k(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseFloat(e[4]),a=parseFloat(e[5]),s=parseInt(e[6]);m.arc(t,n,r,o,i,a,0!=s)},audio:function(t){var n=parseInt(t[0]),r=t[1],o=I[n]=new e.InputStream(i,n),a=null;i.onaudio&&(a=i.onaudio(o,r)),a||(a=e.AudioPlayer.getInstance(o,r)),a?(w[n]=a,i.sendAck(n,"OK",0)):i.sendAck(n,"BAD TYPE",783)},blob:function(e){var t=parseInt(e[0]),n=e[1],r=I[t];r&&r.onblob&&r.onblob(n)},body:function(t){var n=parseInt(t[0]),r=T[n],o=parseInt(t[1]),a=t[2],s=t[3];if(r&&r.onbody){var u=I[o]=new e.InputStream(i,o);r.onbody(u,a,s)}else i.sendAck(o,"Receipt of body unsupported",256)},cfill:function(e){var t=parseInt(e[0]),n=k(parseInt(e[1])),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]),a=parseInt(e[5]);m.setChannelMask(n,t),m.fillColor(n,r,o,i,a)},clip:function(e){var t=k(parseInt(e[0]));m.clip(t)},clipboard:function(t){var n=parseInt(t[0]),r=t[1];if(i.onclipboard){var o=I[n]=new e.InputStream(i,n);i.onclipboard(o,r)}else i.sendAck(n,"Clipboard unsupported",256)},close:function(e){var t=k(parseInt(e[0]));m.close(t)},copy:function(e){var t=k(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]),a=parseInt(e[5]),s=k(parseInt(e[6])),u=parseInt(e[7]),l=parseInt(e[8]);m.setChannelMask(s,a),m.copy(t,n,r,o,i,s,u,l)},cstroke:function(e){var t=parseInt(e[0]),n=k(parseInt(e[1])),r=v[parseInt(e[2])],o=g[parseInt(e[3])],i=parseInt(e[4]),a=parseInt(e[5]),s=parseInt(e[6]),u=parseInt(e[7]),l=parseInt(e[8]);m.setChannelMask(n,t),m.strokeColor(n,r,o,i,a,s,u,l)},cursor:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),r=k(parseInt(e[2])),o=parseInt(e[3]),i=parseInt(e[4]),a=parseInt(e[5]),s=parseInt(e[6]);m.setCursor(t,n,r,o,i,a,s)},curve:function(e){var t=k(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]),a=parseInt(e[5]),s=parseInt(e[6]);m.curveTo(t,n,r,o,i,a,s)},disconnect:function(e){i.disconnect()},dispose:function(e){var t=parseInt(e[0]);if(t>0){var n=k(t);m.dispose(n),delete y[t]}else t<0&&delete y[t]},distort:function(e){var t=parseInt(e[0]),n=parseFloat(e[1]),r=parseFloat(e[2]),o=parseFloat(e[3]),i=parseFloat(e[4]),a=parseFloat(e[5]),s=parseFloat(e[6]);if(t>=0){var u=k(t);m.distort(u,n,r,o,i,a,s)}},error:function(t){var n=t[0],r=parseInt(t[1]);i.onerror&&i.onerror(new e.Status(r,n)),i.disconnect()},end:function(e){var t=parseInt(e[0]),n=I[t];n&&(n.onend&&n.onend(),delete I[t])},file:function(t){var n=parseInt(t[0]),r=t[1],o=t[2];if(i.onfile){var a=I[n]=new e.InputStream(i,n);i.onfile(a,r,o)}else i.sendAck(n,"File transfer unsupported",256)},filesystem:function(t){var n=parseInt(t[0]),r=t[1];if(i.onfilesystem){var o=T[n]=new e.Object(i,n);i.onfilesystem(o,r)}},identity:function(e){var t=k(parseInt(e[0]));m.setTransform(t,1,0,0,1,0,0)},img:function(t){var n=parseInt(t[0]),r=parseInt(t[1]),o=k(parseInt(t[2])),a=t[3],s=parseInt(t[4]),u=parseInt(t[5]),l=I[n]=new e.InputStream(i,n),c=new e.DataURIReader(l,a);c.onend=function(){m.setChannelMask(o,r),m.draw(o,s,u,c.getURI())}},jpeg:function(e){var t=parseInt(e[0]),n=k(parseInt(e[1])),r=parseInt(e[2]),o=parseInt(e[3]),i=e[4];m.setChannelMask(n,t),m.draw(n,r,o,"data:image/jpeg;base64,"+i)},lfill:function(e){var t=parseInt(e[0]),n=k(parseInt(e[1])),r=k(parseInt(e[2]));m.setChannelMask(n,t),m.fillLayer(n,r)},line:function(e){var t=k(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]);m.lineTo(t,n,r)},lstroke:function(e){var t=parseInt(e[0]),n=k(parseInt(e[1])),r=k(parseInt(e[2]));m.setChannelMask(n,t),m.strokeLayer(n,r)},mouse:function(e){var t=parseInt(e[0]),n=parseInt(e[1]);m.showCursor(!0),m.moveCursor(t,n)},move:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]);if(t>0&&n>=0){var a=k(t),s=k(n);m.move(a,s,r,o,i)}},name:function(e){i.onname&&i.onname(e[0])},nest:function(e){var t=o(parseInt(e[0]));t.receive(e[1])},pipe:function(t){var n=parseInt(t[0]),r=t[1],o=t[2];if(i.onpipe){var a=I[n]=new e.InputStream(i,n);i.onpipe(a,r,o)}else i.sendAck(n,"Named pipes unsupported",256)},png:function(e){var t=parseInt(e[0]),n=k(parseInt(e[1])),r=parseInt(e[2]),o=parseInt(e[3]),i=e[4];m.setChannelMask(n,t),m.draw(n,r,o,"data:image/png;base64,"+i)},pop:function(e){var t=k(parseInt(e[0]));m.pop(t)},push:function(e){var t=k(parseInt(e[0]));m.push(t)},rect:function(e){var t=k(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),o=parseInt(e[3]),i=parseInt(e[4]);m.rect(t,n,r,o,i)},reset:function(e){var t=k(parseInt(e[0]));m.reset(t)},set:function(e){var t=k(parseInt(e[0])),n=e[1],r=e[2],o=A[n];o&&o(t,r)},shade:function(e){var t=parseInt(e[0]),n=parseInt(e[1]);if(t>=0){var r=k(t);m.shade(r,n)}},size:function(e){var t=parseInt(e[0]),n=k(t),r=parseInt(e[1]),o=parseInt(e[2]);m.resize(n,r,o)},start:function(e){var t=k(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]);m.moveTo(t,n,r)},sync:function(e){var r=parseInt(e[0]);m.flush(function(){for(var e in w){var n=w[e];n&&n.sync()}r!==h&&(t.sendMessage("sync",r),h=r)}),f===u&&n(l),i.onsync&&i.onsync(r)},transfer:function(t){var n=k(parseInt(t[0])),r=parseInt(t[1]),o=parseInt(t[2]),i=parseInt(t[3]),a=parseInt(t[4]),s=parseInt(t[5]),u=k(parseInt(t[6])),l=parseInt(t[7]),c=parseInt(t[8]);3===s?m.put(n,r,o,i,a,u,l,c):5!==s&&m.transfer(n,r,o,i,a,u,l,c,e.Client.DefaultTransferFunction[s])},transform:function(e){var t=k(parseInt(e[0])),n=parseFloat(e[1]),r=parseFloat(e[2]),o=parseFloat(e[3]),i=parseFloat(e[4]),a=parseFloat(e[5]),s=parseFloat(e[6]);m.transform(t,n,r,o,i,a,s)},undefine:function(e){var t=parseInt(e[0]),n=T[t];n&&n.onundefine&&n.onundefine()},video:function(t){var n=parseInt(t[0]),r=k(parseInt(t[1])),o=t[2],a=I[n]=new e.InputStream(i,n),s=null;i.onvideo&&(s=i.onvideo(a,r,o)),s||(s=e.VideoPlayer.getInstance(a,r,o)),s?(S[n]=s,i.sendAck(n,"OK",0)):i.sendAck(n,"BAD TYPE",783)}};t.oninstruction=function(e,t){var n=L[e];n&&n(t)},this.disconnect=function(){f!=d&&f!=c&&(n(c),p&&window.clearInterval(p),t.sendMessage("disconnect"),t.disconnect(),n(d))},this.connect=function(e){n(s);try{t.connect(e)}catch(r){throw n(a),r}p=window.setInterval(function(){t.sendMessage("nop")},5e3),n(u)}},e.Client.DefaultTransferFunction={0:function(e,t){t.red=t.green=t.blue=0},15:function(e,t){t.red=t.green=t.blue=255},3:function(e,t){t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha},5:function(e,t){},12:function(e,t){t.red=255&~e.red,t.green=255&~e.green,t.blue=255&~e.blue,t.alpha=e.alpha},10:function(e,t){t.red=255&~t.red,t.green=255&~t.green,t.blue=255&~t.blue},1:function(e,t){t.red=e.red&t.red,t.green=e.green&t.green,t.blue=e.blue&t.blue},14:function(e,t){t.red=255&~(e.red&t.red),t.green=255&~(e.green&t.green),t.blue=255&~(e.blue&t.blue)},7:function(e,t){t.red=e.red|t.red,t.green=e.green|t.green,t.blue=e.blue|t.blue},8:function(e,t){t.red=255&~(e.red|t.red),t.green=255&~(e.green|t.green),t.blue=255&~(e.blue|t.blue)},6:function(e,t){t.red=e.red^t.red,t.green=e.green^t.green,t.blue=e.blue^t.blue},9:function(e,t){t.red=255&~(e.red^t.red),t.green=255&~(e.green^t.green),t.blue=255&~(e.blue^t.blue)},4:function(e,t){t.red=255&(~e.red&t.red),t.green=255&(~e.green&t.green),t.blue=255&(~e.blue&t.blue)},13:function(e,t){t.red=255&(~e.red|t.red),t.green=255&(~e.green|t.green),t.blue=255&(~e.blue|t.blue)},2:function(e,t){t.red=255&(e.red&~t.red),t.green=255&(e.green&~t.green),t.blue=255&(e.blue&~t.blue)},11:function(e,t){t.red=255&(e.red|~t.red),t.green=255&(e.green|~t.green),t.blue=255&(e.blue|~t.blue)}};var e=e||{};e.DataURIReader=function(e,t){var n=this,r="data:"+t+";base64,";e.onblob=function(e){r+=e},e.onend=function(){n.onend&&n.onend()},this.getURI=function(){return r},this.onend=null};var e=e||{};e.Display=function(){function t(){for(var e=0;e<p.length;){var t=p[e];if(!t.isReady())break;t.flush(),e++}p.splice(0,e)}function n(e,t){this.isReady=function(){for(var e=0;e<t.length;e++)if(t[e].blocked)return!1;return!0},this.flush=function(){for(var n=0;n<t.length;n++)t[n].execute();e&&e()}}function r(e,n){var r=this;this.blocked=n,this.unblock=function(){r.blocked&&(r.blocked=!1,t())},this.execute=function(){e&&e()}}function o(e,t){var n=new r(e,t);return h.push(n),n}var i=this,a=0,s=0,u=1,l=document.createElement("div");l.style.position="relative",l.style.width=a+"px",l.style.height=s+"px",l.style.transformOrigin=l.style.webkitTransformOrigin=l.style.MozTransformOrigin=l.style.OTransformOrigin=l.style.msTransformOrigin="0 0";var c=new e.Display.VisibleLayer(a,s),d=new e.Display.VisibleLayer(0,0);d.setChannelMask(e.Layer.SRC),l.appendChild(c.getElement()),l.appendChild(d.getElement());var f=document.createElement("div");f.style.position="relative",f.style.width=a*u+"px",f.style.height=s*u+"px",f.appendChild(l),this.cursorHotspotX=0,this.cursorHotspotY=0,this.cursorX=0,this.cursorY=0,this.onresize=null,this.oncursor=null;var h=[],p=[];this.getElement=function(){return f},this.getWidth=function(){return a},this.getHeight=function(){return s},this.getDefaultLayer=function(){return c},this.getCursorLayer=function(){return d},this.createLayer=function(){var t=new e.Display.VisibleLayer(a,s);return t.move(c,0,0,0),t},this.createBuffer=function(){var t=new e.Layer(0,0);return t.autosize=1,t},this.flush=function(e){p.push(new n(e,h)),h=[],t()},this.setCursor=function(e,t,n,r,a,s,u){o(function(){i.cursorHotspotX=e,i.cursorHotspotY=t,d.resize(s,u),d.copy(n,r,a,s,u,0,0),i.moveCursor(i.cursorX,i.cursorY),i.oncursor&&i.oncursor(d.toCanvas(),e,t)})},this.showCursor=function(e){var t=d.getElement(),n=t.parentNode;e===!1?n&&n.removeChild(t):n!==l&&l.appendChild(t)},this.moveCursor=function(e,t){d.translate(e-i.cursorHotspotX,t-i.cursorHotspotY),i.cursorX=e,i.cursorY=t},this.resize=function(e,t,n){o(function(){e.resize(t,n),e===c&&(a=t,s=n,l.style.width=a+"px",l.style.height=s+"px",f.style.width=a*u+"px",f.style.height=s*u+"px",i.onresize&&i.onresize(t,n))})},this.drawImage=function(e,t,n,r){o(function(){e.drawImage(t,n,r)})},this.drawBlob=function(e,t,n,r){var i=URL.createObjectURL(r),a=o(function(){e.drawImage(t,n,s),URL.revokeObjectURL(i)},!0),s=new Image;s.onload=a.unblock,s.src=i},this.draw=function(e,t,n,r){var i=o(function(){e.drawImage(t,n,a)},!0),a=new Image;a.onload=i.unblock,a.src=r},this.play=function(e,t,n,r){var i=document.createElement("video");i.type=t,i.src=r,i.addEventListener("play",function(){function t(){e.drawImage(0,0,i),i.ended||window.setTimeout(t,20)}t()},!1),o(i.play)},this.transfer=function(e,t,n,r,i,a,s,u,l){o(function(){a.transfer(e,t,n,r,i,s,u,l)})},this.put=function(e,t,n,r,i,a,s,u){o(function(){a.put(e,t,n,r,i,s,u)})},this.copy=function(e,t,n,r,i,a,s,u){o(function(){a.copy(e,t,n,r,i,s,u)})},this.moveTo=function(e,t,n){o(function(){e.moveTo(t,n)})},this.lineTo=function(e,t,n){o(function(){e.lineTo(t,n)})},this.arc=function(e,t,n,r,i,a,s){o(function(){e.arc(t,n,r,i,a,s)})},this.curveTo=function(e,t,n,r,i,a,s){o(function(){e.curveTo(t,n,r,i,a,s)})},this.close=function(e){o(function(){e.close()})},this.rect=function(e,t,n,r,i){o(function(){e.rect(t,n,r,i)})},this.clip=function(e){o(function(){e.clip()})},this.strokeColor=function(e,t,n,r,i,a,s,u){o(function(){e.strokeColor(t,n,r,i,a,s,u)})},this.fillColor=function(e,t,n,r,i){o(function(){e.fillColor(t,n,r,i)})},this.strokeLayer=function(e,t,n,r,i){o(function(){e.strokeLayer(t,n,r,i)})},this.fillLayer=function(e,t){o(function(){e.fillLayer(t)})},this.push=function(e){o(function(){e.push()})},this.pop=function(e){o(function(){e.pop()})},this.reset=function(e){o(function(){e.reset()})},this.setTransform=function(e,t,n,r,i,a,s){o(function(){e.setTransform(t,n,r,i,a,s)})},this.transform=function(e,t,n,r,i,a,s){o(function(){e.transform(t,n,r,i,a,s)})},this.setChannelMask=function(e,t){o(function(){e.setChannelMask(t)})},this.setMiterLimit=function(e,t){o(function(){e.setMiterLimit(t)})},this.dispose=function(e){o(function(){e.dispose()})},this.distort=function(e,t,n,r,i,a,s){o(function(){e.distort(t,n,r,i,a,s)})},this.move=function(e,t,n,r,i){o(function(){e.move(t,n,r,i)})},this.shade=function(e,t){o(function(){e.shade(t)})},this.scale=function(e){l.style.transform=l.style.WebkitTransform=l.style.MozTransform=l.style.OTransform=l.style.msTransform="scale("+e+","+e+")",u=e,f.style.width=a*u+"px",f.style.height=s*u+"px"},this.getScale=function(){return u},this.flatten=function(){function e(e){var t=[];for(var n in e.children)t.push(e.children[n]);return t.sort(function(e,t){var n=e.z-t.z;if(0!==n)return n;var r=e.getElement(),o=t.getElement(),i=o.compareDocumentPosition(r);return i&Node.DOCUMENT_POSITION_PRECEDING?-1:i&Node.DOCUMENT_POSITION_FOLLOWING?1:0}),t}function t(n,o,i){if(n.width>0&&n.height>0){var a=r.globalAlpha;r.globalAlpha*=n.alpha/255,r.drawImage(n.getCanvas(),o,i);for(var s=e(n),u=0;u<s.length;u++){var l=s[u];t(l,o+l.x,i+l.y)}r.globalAlpha=a}}var n=document.createElement("canvas");n.width=c.width,n.height=c.height;var r=n.getContext("2d");return t(c,0,0),n}},e.Display.VisibleLayer=function(t,n){e.Layer.apply(this,[t,n]);var r=this;this.__unique_id=e.Display.VisibleLayer.__next_id++,this.alpha=255,this.x=0,this.y=0,this.z=0,this.matrix=[1,0,0,1,0,0],this.parent=null,this.children={};var o=r.getCanvas();o.style.position="absolute",o.style.left="0px",o.style.top="0px";var i=document.createElement("div");i.appendChild(o),i.style.width=t+"px",i.style.height=n+"px",i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.overflow="hidden";var a=this.resize;this.resize=function(e,t){i.style.width=e+"px",i.style.height=t+"px",a(e,t)},this.getElement=function(){return i};var s="translate(0px, 0px)",u="matrix(1, 0, 0, 1, 0, 0)";this.translate=function(e,t){r.x=e,r.y=t,s="translate("+e+"px,"+t+"px)",i.style.transform=i.style.WebkitTransform=i.style.MozTransform=i.style.OTransform=i.style.msTransform=s+" "+u},this.move=function(e,t,n,o){if(r.parent!==e){r.parent&&delete r.parent.children[r.__unique_id],r.parent=e,e.children[r.__unique_id]=r;var a=e.getElement();a.appendChild(i)}r.translate(t,n),r.z=o,i.style.zIndex=o},this.shade=function(e){r.alpha=e,i.style.opacity=e/255},this.dispose=function(){r.parent&&(delete r.parent.children[r.__unique_id],r.parent=null),i.parentNode&&i.parentNode.removeChild(i)},this.distort=function(e,t,n,o,a,l){r.matrix=[e,t,n,o,a,l],u="matrix("+e+","+t+","+n+","+o+","+a+","+l+")",i.style.transform=i.style.WebkitTransform=i.style.MozTransform=i.style.OTransform=i.style.msTransform=s+" "+u}},e.Display.VisibleLayer.__next_id=0;var e=e||{};e.InputStream=function(e,t){var n=this;this.index=t,this.onblob=null,this.onend=null,this.sendAck=function(t,r){e.sendAck(n.index,t,r)}};var e=e||{};e.IntegerPool=function(){var e=this,t=[];this.next_int=0,this.next=function(){return t.length>0?t.shift():e.next_int++},this.free=function(e){t.push(e)}};var e=e||{};e.JSONReader=function(t){var n=this,r=new e.StringReader(t),o="";this.getLength=function(){return o.length},this.getJSON=function(){return JSON.parse(o)},r.ontext=function(e){o+=e,n.onprogress&&n.onprogress(e.length)},r.onend=function(){n.onend&&n.onend()},this.onprogress=null,this.onend=null};var e=e||{};e.Keyboard=function(t){function n(e,t,n){if(!e)return null;var r,i=e.indexOf("U+");if(i>=0){var a=e.substring(i+2);r=String.fromCharCode(parseInt(a,16))}else{if(1!==e.length||3===t)return S(p[e],t);r=e}n===!0?r=r.toUpperCase():n===!1&&(r=r.toLowerCase());var s=r.charCodeAt(0);return o(s)}function r(e){return e<=31||e>=127&&e<=159}function o(e){return r(e)?65280|e:e>=0&&e<=255?e:e>=256&&e<=1114111?16777216|e:null}function i(e,t){return S(h[e],t)}function a(){var e=E();if(!e)return!1;var t;do t=e,e=E();while(null!==e);return t.defaultPrevented}var s=this;this.onkeydown=null,this.onkeyup=null;var u=function(){var e=this;this.timestamp=(new Date).getTime(),this.defaultPrevented=!1,this.keysym=null,this.reliable=!1,this.getAge=function(){return(new Date).getTime()-e.timestamp}},l=function(e,t,r,o){u.apply(this),this.keyCode=e,this.keyIdentifier=t,this.key=r,this.location=o,this.keysym=n(r,o)||i(e,o),this.keysym&&!b(this.keysym)&&(this.reliable=!0),!this.keysym&&I(e,t)&&(this.keysym=n(t,o,s.modifiers.shift));var a=!(s.modifiers.ctrl||navigator&&navigator.platform&&navigator.platform.match(/^mac/i)),l=!s.modifiers.alt;(l&&s.modifiers.ctrl||a&&s.modifiers.alt||s.modifiers.meta||s.modifiers.hyper)&&(this.reliable=!0),m[e]=this.keysym};l.prototype=new u;var c=function(e){u.apply(this),this.charCode=e,this.keysym=o(e),this.reliable=!0};c.prototype=new u;var d=function(e,t,r,o){u.apply(this),this.keyCode=e,this.keyIdentifier=t,this.key=r,this.location=o,this.keysym=m[e]||i(e,o)||n(r,o),this.reliable=!0};d.prototype=new u;var f=[],h={8:[65288],9:[65289],12:[65291,65291,65291,65461],13:[65293],16:[65505,65505,65506],17:[65507,65507,65508],18:[65513,65513,65027],19:[65299],20:[65509],27:[65307],32:[32],33:[65365,65365,65365,65465],34:[65366,65366,65366,65459],35:[65367,65367,65367,65457],36:[65360,65360,65360,65463],37:[65361,65361,65361,65460],38:[65362,65362,65362,65464],39:[65363,65363,65363,65462],40:[65364,65364,65364,65458],45:[65379,65379,65379,65456],46:[65535,65535,65535,65454],91:[65515],92:[65383],93:null,96:[65456],97:[65457],98:[65458],99:[65459],100:[65460],101:[65461],102:[65462],103:[65463],104:[65464],105:[65465],106:[65450],107:[65451],109:[65453],110:[65454],111:[65455],112:[65470],113:[65471],114:[65472],115:[65473],116:[65474],117:[65475],118:[65476],119:[65477],120:[65478],121:[65479],122:[65480],123:[65481],144:[65407],145:[65300],225:[65027]},p={Again:[65382],AllCandidates:[65341],Alphanumeric:[65328],Alt:[65513,65513,65027],Attn:[64782],AltGraph:[65027],ArrowDown:[65364],ArrowLeft:[65361],ArrowRight:[65363],ArrowUp:[65362],Backspace:[65288],CapsLock:[65509],Cancel:[65385],Clear:[65291],Convert:[65313],Copy:[64789],Crsel:[64796],CrSel:[64796],CodeInput:[65335],Compose:[65312],Control:[65507,65507,65508],ContextMenu:[65383],DeadGrave:[65104],DeadAcute:[65105],DeadCircumflex:[65106],DeadTilde:[65107],DeadMacron:[65108],DeadBreve:[65109],DeadAboveDot:[65110],DeadUmlaut:[65111],DeadAboveRing:[65112],DeadDoubleacute:[65113],DeadCaron:[65114],DeadCedilla:[65115],DeadOgonek:[65116],DeadIota:[65117],DeadVoicedSound:[65118],DeadSemivoicedSound:[65119],Delete:[65535],Down:[65364],End:[65367],Enter:[65293],EraseEof:[64774],Escape:[65307],Execute:[65378],Exsel:[64797],ExSel:[64797],F1:[65470],F2:[65471],F3:[65472],F4:[65473],F5:[65474],F6:[65475],F7:[65476],F8:[65477],F9:[65478],F10:[65479],F11:[65480],F12:[65481],F13:[65482],F14:[65483],F15:[65484],F16:[65485],F17:[65486],F18:[65487],F19:[65488],F20:[65489],F21:[65490],F22:[65491],F23:[65492],F24:[65493],Find:[65384],GroupFirst:[65036],GroupLast:[65038],GroupNext:[65032],GroupPrevious:[65034],FullWidth:null,HalfWidth:null,HangulMode:[65329],Hankaku:[65321],HanjaMode:[65332],Help:[65386],Hiragana:[65317],HiraganaKatakana:[65319],Home:[65360],Hyper:[65517,65517,65518],Insert:[65379],JapaneseHiragana:[65317],JapaneseKatakana:[65318],JapaneseRomaji:[65316],JunjaMode:[65336],KanaMode:[65325],KanjiMode:[65313],Katakana:[65318],Left:[65361],Meta:[65511,65511,65512],ModeChange:[65406],NumLock:[65407],PageDown:[65366],PageUp:[65365],Pause:[65299],Play:[64790],PreviousCandidate:[65342],PrintScreen:[64797],Redo:[65382],Right:[65363],RomanCharacters:null,Scroll:[65300],Select:[65376],Separator:[65452],Shift:[65505,65505,65506],SingleCandidate:[65340],Super:[65515,65515,65516],Tab:[65289],Up:[65362],Undo:[65381],Win:[65515],Zenkaku:[65320],ZenkakuHankaku:[65322]},v={65027:!0,65505:!0,65506:!0,65507:!0,65508:!0,65511:!0,65512:!0,65513:!0,65514:!0,65515:!0,65516:!0};this.modifiers=new e.Keyboard.ModifierState,this.pressed={};var g={},m={},y=null,w=null,S=function(e,t){return e?e[t]||e[0]:null},b=function(e){return e>=0&&e<=255||16777216===(4294901760&e)},I=function(e,t){if(!t)return!1;var n=t.indexOf("U+");if(n===-1)return!0;var r=parseInt(t.substring(n+2),16);return e!==r||(e>=65&&e<=90||e>=48&&e<=57)};this.press=function(e){if(null!==e){if(!s.pressed[e]&&(s.pressed[e]=!0,s.onkeydown)){var t=s.onkeydown(e);return g[e]=t,window.clearTimeout(y),window.clearInterval(w),v[e]||(y=window.setTimeout(function(){w=window.setInterval(function(){s.onkeyup(e),s.onkeydown(e)},50)},500)),t}return g[e]||!1}},this.release=function(e){s.pressed[e]&&(delete s.pressed[e],window.clearTimeout(y),window.clearInterval(w),null!==e&&s.onkeyup&&s.onkeyup(e))},this.reset=function(){for(var e in s.pressed)s.release(parseInt(e));f=[]};var T=function(t){var n=e.Keyboard.ModifierState.fromKeyboardEvent(t);s.modifiers.alt&&n.alt===!1&&(s.release(65513),s.release(65514),s.release(65027)),s.modifiers.shift&&n.shift===!1&&(s.release(65505),s.release(65506)),s.modifiers.ctrl&&n.ctrl===!1&&(s.release(65507),s.release(65508)),s.modifiers.meta&&n.meta===!1&&(s.release(65511),s.release(65512)),s.modifiers.hyper&&n.hyper===!1&&(s.release(65515),s.release(65516)),s.modifiers=n},C=function(e){s.modifiers.ctrl&&s.modifiers.alt&&(e>=65&&e<=90||e>=97&&e<=122||(e<=255||16777216===(4278190080&e))&&(s.release(65507),s.release(65508),s.release(65513),s.release(65514)))},E=function(){var e=f[0];if(!e)return null;if(!(e instanceof l)){if(e instanceof d){var t=e.keysym;return t?(s.release(t),e.defaultPrevented=!0,f.shift()):(s.reset(),e)}return f.shift()}var t=null,n=[];if(e.reliable?(t=e.keysym,n=f.splice(0,1)):f[1]instanceof c?(t=f[1].keysym,n=f.splice(0,2)):f[1]&&(t=e.keysym,n=f.splice(0,1)),n.length>0){if(t){C(t);var r=!s.press(t);m[e.keyCode]=t,s.modifiers.meta&&65511!==t&&65512!==t&&s.release(t);for(var o=0;o<n.length;o++)n[o].defaultPrevented=r}return e}return null},k=function(e){return"location"in e?e.location:"keyLocation"in e?e.keyLocation:0};t.addEventListener("keydown",function(e){if(s.onkeydown){var t;if(window.event?t=window.event.keyCode:e.which&&(t=e.which),T(e),229!==t){var n=new l(t,e.keyIdentifier,e.key,k(e));f.push(n),a()&&e.preventDefault()}}},!0),t.addEventListener("keypress",function(e){if(s.onkeydown||s.onkeyup){var t;window.event?t=window.event.keyCode:e.which&&(t=e.which),T(e);var n=new c(t);f.push(n),a()&&e.preventDefault()}},!0),t.addEventListener("keyup",function(e){if(s.onkeyup){e.preventDefault();var t;window.event?t=window.event.keyCode:e.which&&(t=e.which),T(e);var n=new d(t,e.keyIdentifier,e.key,k(e));f.push(n),a()}},!0)},e.Keyboard.ModifierState=function(){this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.hyper=!1},e.Keyboard.ModifierState.fromKeyboardEvent=function(t){var n=new e.Keyboard.ModifierState;return n.shift=t.shiftKey,n.ctrl=t.ctrlKey,n.alt=t.altKey,n.meta=t.metaKey,t.getModifierState&&(n.hyper=t.getModifierState("OS")||t.getModifierState("Super")||t.getModifierState("Hyper")||t.getModifierState("Win")),n};var e=e||{};e.Layer=function(t,n){function r(e,t,n,r){var i,a=n+e,s=r+t;i=a>o.width?a:o.width;var u;u=s>o.height?s:o.height,o.resize(i,u)}var o=this,i=64,a=document.createElement("canvas"),s=a.getContext("2d");s.save();
var u=!0,l=!0,c=0,d={1:"destination-in",2:"destination-out",4:"source-in",6:"source-atop",8:"source-out",9:"destination-atop",10:"xor",11:"destination-over",12:"copy",14:"source-over",15:"lighter"},f=function(e,t){e=e||0,t=t||0;var n=Math.ceil(e/i)*i,r=Math.ceil(t/i)*i;if(a.width!==n||a.height!==r){var l=null;if(!u&&0!==a.width&&0!==a.height){l=document.createElement("canvas"),l.width=Math.min(o.width,e),l.height=Math.min(o.height,t);var d=l.getContext("2d");d.drawImage(a,0,0,l.width,l.height,0,0,l.width,l.height)}var f=s.globalCompositeOperation;a.width=n,a.height=r,l&&s.drawImage(l,0,0,l.width,l.height,0,0,l.width,l.height),s.globalCompositeOperation=f,c=0,s.save()}else o.reset();o.width=e,o.height=t};this.autosize=!1,this.width=t,this.height=n,this.getCanvas=function(){return a},this.toCanvas=function(){var e=document.createElement("canvas");e.width=o.width,e.height=o.height;var t=e.getContext("2d");return t.drawImage(o.getCanvas(),0,0),e},this.resize=function(e,t){e===o.width&&t===o.height||f(e,t)},this.drawImage=function(e,t,n){o.autosize&&r(e,t,n.width,n.height),s.drawImage(n,e,t),u=!1},this.transfer=function(t,n,i,a,l,c,d,f){var h=t.getCanvas();if(!(n>=h.width||i>=h.height)&&(n+a>h.width&&(a=h.width-n),i+l>h.height&&(l=h.height-i),0!==a&&0!==l)){o.autosize&&r(c,d,a,l);for(var p=t.getCanvas().getContext("2d").getImageData(n,i,a,l),v=s.getImageData(c,d,a,l),g=0;g<a*l*4;g+=4){var m=new e.Layer.Pixel(p.data[g],p.data[g+1],p.data[g+2],p.data[g+3]),y=new e.Layer.Pixel(v.data[g],v.data[g+1],v.data[g+2],v.data[g+3]);f(m,y),v.data[g]=y.red,v.data[g+1]=y.green,v.data[g+2]=y.blue,v.data[g+3]=y.alpha}s.putImageData(v,c,d),u=!1}},this.put=function(e,t,n,i,a,l,c){var d=e.getCanvas();if(!(t>=d.width||n>=d.height)&&(t+i>d.width&&(i=d.width-t),n+a>d.height&&(a=d.height-n),0!==i&&0!==a)){o.autosize&&r(l,c,i,a);var f=e.getCanvas().getContext("2d").getImageData(t,n,i,a);s.putImageData(f,l,c),u=!1}},this.copy=function(e,t,n,i,a,l,c){var d=e.getCanvas();t>=d.width||n>=d.height||(t+i>d.width&&(i=d.width-t),n+a>d.height&&(a=d.height-n),0!==i&&0!==a&&(o.autosize&&r(l,c,i,a),s.drawImage(d,t,n,i,a,l,c,i,a),u=!1))},this.moveTo=function(e,t){l&&(s.beginPath(),l=!1),o.autosize&&r(e,t,0,0),s.moveTo(e,t)},this.lineTo=function(e,t){l&&(s.beginPath(),l=!1),o.autosize&&r(e,t,0,0),s.lineTo(e,t)},this.arc=function(e,t,n,i,a,u){l&&(s.beginPath(),l=!1),o.autosize&&r(e,t,0,0),s.arc(e,t,n,i,a,u)},this.curveTo=function(e,t,n,i,a,u){l&&(s.beginPath(),l=!1),o.autosize&&r(a,u,0,0),s.bezierCurveTo(e,t,n,i,a,u)},this.close=function(){s.closePath(),l=!0},this.rect=function(e,t,n,i){l&&(s.beginPath(),l=!1),o.autosize&&r(e,t,n,i),s.rect(e,t,n,i)},this.clip=function(){s.clip(),l=!0},this.strokeColor=function(e,t,n,r,o,i,a){s.lineCap=e,s.lineJoin=t,s.lineWidth=n,s.strokeStyle="rgba("+r+","+o+","+i+","+a/255+")",s.stroke(),u=!1,l=!0},this.fillColor=function(e,t,n,r){s.fillStyle="rgba("+e+","+t+","+n+","+r/255+")",s.fill(),u=!1,l=!0},this.strokeLayer=function(e,t,n,r){s.lineCap=e,s.lineJoin=t,s.lineWidth=n,s.strokeStyle=s.createPattern(r.getCanvas(),"repeat"),s.stroke(),u=!1,l=!0},this.fillLayer=function(e){s.fillStyle=s.createPattern(e.getCanvas(),"repeat"),s.fill(),u=!1,l=!0},this.push=function(){s.save(),c++},this.pop=function(){c>0&&(s.restore(),c--)},this.reset=function(){for(;c>0;)s.restore(),c--;s.restore(),s.save(),s.beginPath(),l=!1},this.setTransform=function(e,t,n,r,o,i){s.setTransform(e,t,n,r,o,i)},this.transform=function(e,t,n,r,o,i){s.transform(e,t,n,r,o,i)},this.setChannelMask=function(e){s.globalCompositeOperation=d[e]},this.setMiterLimit=function(e){s.miterLimit=e},f(t,n),a.style.zIndex=-1},e.Layer.ROUT=2,e.Layer.ATOP=6,e.Layer.XOR=10,e.Layer.ROVER=11,e.Layer.OVER=14,e.Layer.PLUS=15,e.Layer.RIN=1,e.Layer.IN=4,e.Layer.OUT=8,e.Layer.RATOP=9,e.Layer.SRC=12,e.Layer.Pixel=function(e,t,n,r){this.red=e,this.green=t,this.blue=n,this.alpha=r};var e=e||{};e.Mouse=function(t){function n(e){e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function r(){a=i.touchMouseThreshold}function o(e){var t=e.deltaY||-e.wheelDeltaY||-e.wheelDelta;if(t?1===e.deltaMode?t=e.deltaY*i.PIXELS_PER_LINE:2===e.deltaMode&&(t=e.deltaY*i.PIXELS_PER_PAGE):t=e.detail*i.PIXELS_PER_LINE,s+=t,s<=-i.scrollThreshold){do i.onmousedown&&(i.currentState.up=!0,i.onmousedown(i.currentState)),i.onmouseup&&(i.currentState.up=!1,i.onmouseup(i.currentState)),s+=i.scrollThreshold;while(s<=-i.scrollThreshold);s=0}if(s>=i.scrollThreshold){do i.onmousedown&&(i.currentState.down=!0,i.onmousedown(i.currentState)),i.onmouseup&&(i.currentState.down=!1,i.onmouseup(i.currentState)),s-=i.scrollThreshold;while(s>=i.scrollThreshold);s=0}n(e)}var i=this;this.touchMouseThreshold=3,this.scrollThreshold=53,this.PIXELS_PER_LINE=18,this.PIXELS_PER_PAGE=16*this.PIXELS_PER_LINE,this.currentState=new e.Mouse.State(0,0,(!1),(!1),(!1),(!1),(!1)),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,this.onmouseout=null;var a=0,s=0;t.addEventListener("contextmenu",function(e){n(e)},!1),t.addEventListener("mousemove",function(e){return n(e),a?void a--:(i.currentState.fromClientPosition(t,e.clientX,e.clientY),void(i.onmousemove&&i.onmousemove(i.currentState)))},!1),t.addEventListener("mousedown",function(e){if(n(e),!a){switch(e.button){case 0:i.currentState.left=!0;break;case 1:i.currentState.middle=!0;break;case 2:i.currentState.right=!0}i.onmousedown&&i.onmousedown(i.currentState)}},!1),t.addEventListener("mouseup",function(e){if(n(e),!a){switch(e.button){case 0:i.currentState.left=!1;break;case 1:i.currentState.middle=!1;break;case 2:i.currentState.right=!1}i.onmouseup&&i.onmouseup(i.currentState)}},!1),t.addEventListener("mouseout",function(e){e||(e=window.event);for(var r=e.relatedTarget||e.toElement;r;){if(r===t)return;r=r.parentNode}n(e),(i.currentState.left||i.currentState.middle||i.currentState.right)&&(i.currentState.left=!1,i.currentState.middle=!1,i.currentState.right=!1,i.onmouseup&&i.onmouseup(i.currentState)),i.onmouseout&&i.onmouseout()},!1),t.addEventListener("selectstart",function(e){n(e)},!1),t.addEventListener("touchmove",r,!1),t.addEventListener("touchstart",r,!1),t.addEventListener("touchend",r,!1),t.addEventListener("DOMMouseScroll",o,!1),t.addEventListener("mousewheel",o,!1),t.addEventListener("wheel",o,!1);var u=function(){var e=document.createElement("div");if(!("cursor"in e.style))return!1;try{e.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX///+nxBvIAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==) 0 0, auto"}catch(t){return!1}return/\burl\([^()]*\)\s+0\s+0\b/.test(e.style.cursor||"")}();this.setCursor=function(e,n,r){if(u){var o=e.toDataURL("image/png");return t.style.cursor="url("+o+") "+n+" "+r+", auto",!0}return!1}},e.Mouse.State=function(e,t,n,r,o,i,a){var s=this;this.x=e,this.y=t,this.left=n,this.middle=r,this.right=o,this.up=i,this.down=a,this.fromClientPosition=function(e,t,n){s.x=t-e.offsetLeft,s.y=n-e.offsetTop;for(var r=e.offsetParent;r&&r!==document.body;)s.x-=r.offsetLeft-r.scrollLeft,s.y-=r.offsetTop-r.scrollTop,r=r.offsetParent;if(r){var o=document.body.scrollLeft||document.documentElement.scrollLeft,i=document.body.scrollTop||document.documentElement.scrollTop;s.x-=r.offsetLeft-o,s.y-=r.offsetTop-i}}},e.Mouse.Touchpad=function(t){var n=this;this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=10*(window.devicePixelRatio||1),this.currentState=new e.Mouse.State(0,0,(!1),(!1),(!1),(!1),(!1)),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null;var r=0,o=0,i=0,a=0,s=0,u={1:"left",2:"right",3:"middle"},l=!1,c=null;t.addEventListener("touchend",function(e){if(e.preventDefault(),l&&0===e.touches.length){var t=(new Date).getTime(),o=u[r];n.currentState[o]&&(n.currentState[o]=!1,n.onmouseup&&n.onmouseup(n.currentState),c&&(window.clearTimeout(c),c=null)),t-a<=n.clickTimingThreshold&&s<n.clickMoveThreshold&&(n.currentState[o]=!0,n.onmousedown&&n.onmousedown(n.currentState),c=window.setTimeout(function(){n.currentState[o]=!1,n.onmouseup&&n.onmouseup(n.currentState),l=!1},n.clickTimingThreshold)),c||(l=!1)}},!1),t.addEventListener("touchstart",function(e){if(e.preventDefault(),r=Math.min(e.touches.length,3),c&&(window.clearTimeout(c),c=null),!l){l=!0;var t=e.touches[0];o=t.clientX,i=t.clientY,a=(new Date).getTime(),s=0}},!1),t.addEventListener("touchmove",function(e){e.preventDefault();var u=e.touches[0],l=u.clientX-o,c=u.clientY-i;if(s+=Math.abs(l)+Math.abs(c),1===r){var d=s/((new Date).getTime()-a),f=1+d;n.currentState.x+=l*f,n.currentState.y+=c*f,n.currentState.x<0?n.currentState.x=0:n.currentState.x>=t.offsetWidth&&(n.currentState.x=t.offsetWidth-1),n.currentState.y<0?n.currentState.y=0:n.currentState.y>=t.offsetHeight&&(n.currentState.y=t.offsetHeight-1),n.onmousemove&&n.onmousemove(n.currentState),o=u.clientX,i=u.clientY}else if(2===r&&Math.abs(c)>=n.scrollThreshold){var h;h=c>0?"down":"up",n.currentState[h]=!0,n.onmousedown&&n.onmousedown(n.currentState),n.currentState[h]=!1,n.onmouseup&&n.onmouseup(n.currentState),o=u.clientX,i=u.clientY}},!1)},e.Mouse.Touchscreen=function(t){function n(e){l.currentState[e]||(l.currentState[e]=!0,l.onmousedown&&l.onmousedown(l.currentState))}function r(e){l.currentState[e]&&(l.currentState[e]=!1,l.onmouseup&&l.onmouseup(l.currentState))}function o(e){n(e),r(e)}function i(e,n){l.currentState.fromClientPosition(t,e,n),l.onmousemove&&l.onmousemove(l.currentState)}function a(e){var t=e.touches[0]||e.changedTouches[0],n=t.clientX-d,r=t.clientY-f;return Math.sqrt(n*n+r*r)>=l.clickMoveThreshold}function s(e){var t=e.touches[0];c=!0,d=t.clientX,f=t.clientY}function u(){window.clearTimeout(h),window.clearTimeout(p),c=!1}var l=this,c=!1,d=null,f=null,h=null,p=null;this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=16*(window.devicePixelRatio||1),this.longPressThreshold=500,this.currentState=new e.Mouse.State(0,0,(!1),(!1),(!1),(!1),(!1)),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,t.addEventListener("touchend",function(e){if(c){if(0!==e.touches.length||1!==e.changedTouches.length)return void u();if(window.clearTimeout(p),r("left"),!a(e)&&(e.preventDefault(),!l.currentState.left)){var t=e.changedTouches[0];i(t.clientX,t.clientY),n("left"),h=window.setTimeout(function(){r("left"),u()},l.clickTimingThreshold)}}},!1),t.addEventListener("touchstart",function(e){return 1!==e.touches.length?void u():(e.preventDefault(),s(e),window.clearTimeout(h),void(p=window.setTimeout(function(){var t=e.touches[0];i(t.clientX,t.clientY),o("right"),u()},l.longPressThreshold)))},!1),t.addEventListener("touchmove",function(e){if(c){if(a(e)&&window.clearTimeout(p),1!==e.touches.length)return void u();if(l.currentState.left){e.preventDefault();var t=e.touches[0];i(t.clientX,t.clientY)}}},!1)};var e=e||{},e=e||{};e.Object=function(e,t){var n=this,r={},o=function(e){var t=r[e];if(!t)return null;var n=t.shift();return 0===t.length&&delete r[e],n},i=function(e,t){var n=r[e];n||(n=[],r[e]=n),n.push(t)};this.index=t,this.onbody=function(e,t,n){var r=o(n);r&&r(e,t)},this.onundefine=null,this.requestInputStream=function(t,r){r&&i(t,r),e.requestObjectInputStream(n.index,t)},this.createOutputStream=function(t,r){return e.createObjectOutputStream(n.index,t,r)}},e.Object.ROOT_STREAM="/",e.Object.STREAM_INDEX_MIMETYPE="application/vnd.glyptodon.guacamole.stream-index+json";var e=e||{};e.OnScreenKeyboard=function(t){var n=this,r={},o={},i=[],a=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},s=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(/([^ ]+)[ ]*/g,function(e,n){return n===t?"":e})},u=0,l=function(e,t,n,r){this.width=t,this.height=n,this.scale=function(o){e.style.width=t*o+"px",e.style.height=n*o+"px",r&&(e.style.lineHeight=n*o+"px",e.style.fontSize=o+"px")}},c=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(!(n in r))return!1}return!0},d=function(e){var t=n.keys[e];if(!t)return null;for(var r=t.length-1;r>=0;r--){var o=t[r];if(c(o.requires))return o}return null},f=function(e,t){if(!o[e]){a(t,"guac-keyboard-pressed");var i=d(e);if(i.modifier){var u="guac-keyboard-modifier-"+m(i.modifier),l=r[i.modifier];l?(s(p,u),delete r[i.modifier],n.onkeyup&&n.onkeyup(l)):(a(p,u),r[i.modifier]=i.keysym,n.onkeydown&&n.onkeydown(i.keysym))}else n.onkeydown&&n.onkeydown(i.keysym);o[e]=!0}},h=function(e,t){if(o[e]){s(t,"guac-keyboard-pressed");var r=d(e);!r.modifier&&n.onkeyup&&n.onkeyup(r.keysym),o[e]=!1}},p=document.createElement("div");p.className="guac-keyboard",p.onselectstart=p.onmousemove=p.onmouseup=p.onmousedown=function(e){return u&&u--,e.stopPropagation(),!1},this.touchMouseThreshold=3,this.onkeydown=null,this.onkeyup=null,this.layout=new e.OnScreenKeyboard.Layout(t),this.getElement=function(){return p},this.resize=function(e){for(var t=Math.floor(10*e/n.layout.width)/10,r=0;r<i.length;r++){var o=i[r];o.scale(t)}};var v=function(t,n){if(n instanceof Array){for(var r=[],o=0;o<n.length;o++)r.push(new e.OnScreenKeyboard.Key(n[o],t));return r}return"number"==typeof n?[new e.OnScreenKeyboard.Key({name:t,keysym:n})]:"string"==typeof n?[new e.OnScreenKeyboard.Key({name:t,title:n})]:[new e.OnScreenKeyboard.Key(n,t)]},g=function(e){var n={};for(var r in t.keys)n[r]=v(r,e[r]);return n};this.keys=g(t.keys);var m=function(e){var t=e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[^A-Za-z0-9]+/g,"-").toLowerCase();return t},y=function w(e,t,r){var o,s=document.createElement("div");if(r&&a(s,"guac-keyboard-"+m(r)),t instanceof Array)for(a(s,"guac-keyboard-group"),o=0;o<t.length;o++)w(s,t[o]);else if(t instanceof Object){a(s,"guac-keyboard-group");var c=Object.keys(t).sort();for(o=0;o<c.length;o++){var r=c[o];w(s,t[r],r)}}else if("number"==typeof t)a(s,"guac-keyboard-gap"),i.push(new l(s,t,t));else if("string"==typeof t){var d=t;1===d.length&&(d="0x"+d.charCodeAt(0).toString(16)),a(s,"guac-keyboard-key-container");var p=document.createElement("div");p.className="guac-keyboard-key guac-keyboard-key-"+m(d);var v=n.keys[t];if(v)for(o=0;o<v.length;o++){var g=v[o],y=document.createElement("div");y.className="guac-keyboard-cap",y.textContent=g.title;for(var S=0;S<g.requires.length;S++){var b=g.requires[S];a(y,"guac-keyboard-requires-"+m(b)),a(p,"guac-keyboard-uses-"+m(b))}p.appendChild(y)}s.appendChild(p),i.push(new l(s,n.layout.keyWidths[t]||1,1,(!0)));var I=function(e){e.preventDefault(),u=n.touchMouseThreshold,f(t,p)},T=function(e){e.preventDefault(),u=n.touchMouseThreshold,h(t,p)},C=function(e){e.preventDefault(),0===u&&f(t,p)},E=function(e){e.preventDefault(),0===u&&h(t,p)};p.addEventListener("touchstart",I,!0),p.addEventListener("touchend",T,!0),p.addEventListener("mousedown",C,!0),p.addEventListener("mouseup",E,!0),p.addEventListener("mouseout",E,!0)}e.appendChild(s)};y(p,t.layout)},e.OnScreenKeyboard.Layout=function(e){this.language=e.language,this.type=e.type,this.keys=e.keys,this.layout=e.layout,this.width=e.width,this.keyWidths=e.keyWidths||{}},e.OnScreenKeyboard.Key=function(e,t){this.name=t||e.name,this.title=e.title||this.name,this.keysym=e.keysym||function(e){if(!e||1!==e.length)return null;var t=e.charCodeAt(0);return t>=0&&t<=255?t:t>=256&&t<=1114111?16777216|t:null}(this.title),this.modifier=e.modifier,this.requires=e.requires||[]};var e=e||{};e.OutputStream=function(e,t){var n=this;this.index=t,this.onack=null,this.sendBlob=function(t){e.sendBlob(n.index,t)},this.sendEnd=function(){e.endStream(n.index)}};var e=e||{};e.Parser=function(){var e=this,t="",n=[],r=-1,o=0;this.receive=function(i){for(o>4096&&r>=o&&(t=t.substring(o),r-=o,o=0),t+=i;r<t.length;){if(r>=o){var a=t.substring(o,r),s=t.substring(r,r+1);if(n.push(a),";"==s){var u=n.shift();null!=e.oninstruction&&e.oninstruction(u,n),n.length=0}else if(","!=s)throw new Error("Illegal terminator.");o=r+1}var l=t.indexOf(".",o);if(l==-1){o=t.length;break}var c=parseInt(t.substring(r+1,l));if(NaN==c)throw new Error("Non-numeric character in element length.");o=l+1,r=o+c}},this.oninstruction=null};var e=e||{};e.RawAudioFormat=function(e){this.bytesPerSample=e.bytesPerSample,this.channels=e.channels,this.rate=e.rate},e.RawAudioFormat.parse=function(t){var n,r=null,o=1;if("audio/L8;"===t.substring(0,9))t=t.substring(9),n=1;else{if("audio/L16;"!==t.substring(0,10))return null;t=t.substring(10),n=2}for(var i=t.split(","),a=0;a<i.length;a++){var s=i[a],u=s.indexOf("=");if(u===-1)return null;var l=s.substring(0,u),c=s.substring(u+1);switch(l){case"channels":o=parseInt(c);break;case"rate":r=parseInt(c);break;default:return null}}return null===r?null:new e.RawAudioFormat({bytesPerSample:n,channels:o,rate:r})};var e=e||{};e.Status=function(e,t){var n=this;this.code=e,this.message=t,this.isError=function(){return n.code<0||n.code>255}},e.Status.Code={SUCCESS:0,UNSUPPORTED:256,SERVER_ERROR:512,SERVER_BUSY:513,UPSTREAM_TIMEOUT:514,UPSTREAM_ERROR:515,RESOURCE_NOT_FOUND:516,RESOURCE_CONFLICT:517,RESOURCE_CLOSED:518,UPSTREAM_NOT_FOUND:519,UPSTREAM_UNAVAILABLE:520,SESSION_CONFLICT:521,SESSION_TIMEOUT:522,SESSION_CLOSED:523,CLIENT_BAD_REQUEST:768,CLIENT_UNAUTHORIZED:769,CLIENT_FORBIDDEN:771,CLIENT_TIMEOUT:776,CLIENT_OVERRUN:781,CLIENT_BAD_TYPE:783,CLIENT_TOO_MANY:797};var e=e||{};e.StringReader=function(t){function n(e){for(var t="",n=new Uint8Array(e),r=0;r<n.length;r++){var o=n[r];0===i?127===(127|o)?t+=String.fromCharCode(o):223===(31|o)?(a=31&o,i=1):239===(15|o)?(a=15&o,i=2):247===(7|o)?(a=7&o,i=3):t+="�":191===(63|o)?(a=a<<6|63&o,i--,0===i&&(t+=String.fromCharCode(a))):(i=0,t+="�")}return t}var r=this,o=new e.ArrayBufferReader(t),i=0,a=0;o.ondata=function(e){var t=n(e);r.ontext&&r.ontext(t)},o.onend=function(){r.onend&&r.onend()},this.ontext=null,this.onend=null};var e=e||{};e.StringWriter=function(t){function n(e){if(u+e>=s.length){var t=new Uint8Array(2*(u+e));t.set(s),s=t}u+=e}function r(e){var t,o;if(e<=127)t=0,o=1;else if(e<=2047)t=192,o=2;else if(e<=65535)t=224,o=3;else{if(!(e<=2097151))return void r(65533);t=240,o=4}n(o);for(var i=u-1,a=1;a<o;a++)s[i--]=128|63&e,e>>=6;s[i]=t|e}function o(e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);r(n)}if(u>0){var o=s.subarray(0,u);return u=0,o}}var i=this,a=new e.ArrayBufferWriter(t),s=new Uint8Array(8192),u=0;a.onack=function(e){i.onack&&i.onack(e)},this.sendText=function(e){e.length&&a.sendData(o(e))},this.sendEnd=function(){a.sendEnd()},this.onack=null};var e=e||{};e.Tunnel=function(){this.connect=function(e){},this.disconnect=function(){},this.sendMessage=function(e){},this.state=e.Tunnel.State.CONNECTING,this.receiveTimeout=15e3,this.uuid=null,this.onerror=null,this.onstatechange=null,this.oninstruction=null},e.Tunnel.INTERNAL_DATA_OPCODE="",e.Tunnel.State={CONNECTING:0,OPEN:1,CLOSED:2},e.HTTPTunnel=function(t,n){function r(){window.clearTimeout(w),w=window.setTimeout(function(){o(new e.Status(e.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))},l.receiveTimeout)}function o(t){l.state!==e.Tunnel.State.CLOSED&&(t.code!==e.Status.Code.SUCCESS&&l.onerror&&(l.state!==e.Tunnel.State.CONNECTING&&t.code===e.Status.Code.RESOURCE_NOT_FOUND||l.onerror(t)),l.state=e.Tunnel.State.CLOSED,g=!1,l.onstatechange&&l.onstatechange(l.state))}function i(){if(l.state===e.Tunnel.State.OPEN)if(m.length>0){g=!0;var t=new XMLHttpRequest;t.open("POST",f+l.uuid),t.withCredentials=y,t.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),t.onreadystatechange=function(){4===t.readyState&&(200!==t.status?a(t):i())},t.send(m),m=""}else g=!1}function a(t){var n=parseInt(t.getResponseHeader("Guacamole-Status-Code")),r=t.getResponseHeader("Guacamole-Error-Message");o(new e.Status(n,r))}function s(t){function n(){if(l.state!==e.Tunnel.State.OPEN)return void(null!==o&&clearInterval(o));if(!(t.readyState<2)){var c;try{c=t.status}catch(p){c=200}if(i||200!==c||(i=u()),3===t.readyState||4===t.readyState){if(r(),v===h&&(3!==t.readyState||o?4===t.readyState&&o&&clearInterval(o):o=setInterval(n,30)),0===t.status)return void l.disconnect();if(200!==t.status)return void a(t);var m;try{m=t.responseText}catch(p){return}for(;d<m.length;){if(d>=f){var y=m.substring(f,d),w=m.substring(d,d+1);if(g.push(y),";"===w){var S=g.shift();l.oninstruction&&l.oninstruction(S,g),g.length=0}f=d+1}var b=m.indexOf(".",f);if(b===-1){f=m.length;break}var I=parseInt(m.substring(d+1,b));if(0===I){o&&clearInterval(o),t.onreadystatechange=null,t.abort(),i&&s(i);break}f=b+1,d=f+I}}}}var o=null,i=null,c=0,d=-1,f=0,g=new Array;v===h?t.onreadystatechange=function(){3===t.readyState&&(c++,c>=2&&(v=p,t.onreadystatechange=n)),n()}:t.onreadystatechange=n,n()}function u(){var e=new XMLHttpRequest;return e.open("GET",d+l.uuid+":"+S++),e.withCredentials=y,e.send(null),e}var l=this,c=t+"?connect",d=t+"?read:",f=t+"?write:",h=1,p=0,v=h,g=!1,m="",y=!!n,w=null;this.sendMessage=function(){function t(e){var t=new String(e);return t.length+"."+t}if(l.state===e.Tunnel.State.OPEN&&0!==arguments.length){for(var n=t(arguments[0]),r=1;r<arguments.length;r++)n+=","+t(arguments[r]);n+=";",m+=n,g||i()}};var S=0;this.connect=function(t){r();var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(200!==n.status)return void a(n);r(),l.uuid=n.responseText,l.state=e.Tunnel.State.OPEN,l.onstatechange&&l.onstatechange(l.state),s(u())}},n.open("POST",c,!0),n.withCredentials=y,n.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(t)},this.disconnect=function(){o(new e.Status(e.Status.Code.SUCCESS,"Manually closed."))}},e.HTTPTunnel.prototype=new e.Tunnel,e.WebSocketTunnel=function(t){function n(){window.clearTimeout(a),a=window.setTimeout(function(){r(new e.Status(e.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))},o.receiveTimeout)}function r(t){o.state!==e.Tunnel.State.CLOSED&&(t.code!==e.Status.Code.SUCCESS&&o.onerror&&o.onerror(t),o.state=e.Tunnel.State.CLOSED,o.onstatechange&&o.onstatechange(o.state),i.close())}var o=this,i=null,a=null,s={"http:":"ws:","https:":"wss:"};if("ws:"!==t.substring(0,3)&&"wss:"!==t.substring(0,4)){var u=s[window.location.protocol];if("/"===t.substring(0,1))t=u+"//"+window.location.host+t;else{var l=window.location.pathname.lastIndexOf("/"),c=window.location.pathname.substring(0,l+1);t=u+"//"+window.location.host+c+t}}this.sendMessage=function(t){function n(e){var t=new String(e);return t.length+"."+t}if(o.state===e.Tunnel.State.OPEN&&0!==arguments.length){for(var r=n(arguments[0]),a=1;a<arguments.length;a++)r+=","+n(arguments[a]);r+=";",i.send(r)}},this.connect=function(a){n(),i=new WebSocket(t+"?"+a,"guacamole"),i.onopen=function(e){n()},i.onclose=function(t){r(new e.Status(parseInt(t.reason),t.reason))},i.onerror=function(t){r(new e.Status(e.Status.Code.SERVER_ERROR,t.data))},i.onmessage=function(t){n();var i,a=t.data,s=0,u=[];do{var l=a.indexOf(".",s);if(l!==-1){var c=parseInt(a.substring(i+1,l));s=l+1,i=s+c}else r(new e.Status(e.Status.Code.SERVER_ERROR,"Incomplete instruction."));var d=a.substring(s,i),f=a.substring(i,i+1);if(u.push(d),";"===f){var h=u.shift();o.state!==e.Tunnel.State.OPEN&&(h===e.Tunnel.INTERNAL_DATA_OPCODE&&(o.uuid=u[0]),o.state=e.Tunnel.State.OPEN,o.onstatechange&&o.onstatechange(o.state)),h!==e.Tunnel.INTERNAL_DATA_OPCODE&&o.oninstruction&&o.oninstruction(h,u),u.length=0}s=i+1}while(s<a.length)}},this.disconnect=function(){r(new e.Status(e.Status.Code.SUCCESS,"Manually closed."))}},e.WebSocketTunnel.prototype=new e.Tunnel,e.ChainedTunnel=function(t){function n(t){function s(){t.onstatechange=o.onstatechange,t.oninstruction=o.oninstruction,t.onerror=o.onerror,o.uuid=t.uuid,a=t}o.disconnect=t.disconnect,o.sendMessage=t.sendMessage;var u=function(r){if(r&&r.code===e.Status.Code.UPSTREAM_TIMEOUT)return i=[],null;var o=i.shift();return o&&(t.onerror=null,t.oninstruction=null,t.onstatechange=null,n(o)),o};t.onstatechange=function(t){switch(t){case e.Tunnel.State.OPEN:s(),o.onstatechange&&o.onstatechange(t);break;case e.Tunnel.State.CLOSED:!u()&&o.onstatechange&&o.onstatechange(t)}},t.oninstruction=function(e,t){s(),o.oninstruction&&o.oninstruction(e,t)},t.onerror=function(e){!u(e)&&o.onerror&&o.onerror(e)},t.connect(r)}for(var r,o=this,i=[],a=null,s=0;s<arguments.length;s++)i.push(arguments[s]);this.connect=function(t){r=t;var s=a?a:i.shift();s?n(s):o.onerror&&o.onerror(e.Status.Code.SERVER_ERROR,"No tunnels to try.")}},e.ChainedTunnel.prototype=new e.Tunnel;var e=e||{};e.API_VERSION="0.9.12-incubating";var e=e||{};e.VideoPlayer=function(){this.sync=function(){}},e.VideoPlayer.isSupportedType=function(e){return!1},e.VideoPlayer.getSupportedTypes=function(){return[]},e.VideoPlayer.getInstance=function(e,t,n){return null},module&&module.exports?module.exports=e:window.Guacamole=e}();